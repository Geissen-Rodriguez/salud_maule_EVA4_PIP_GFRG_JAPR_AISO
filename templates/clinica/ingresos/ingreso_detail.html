{% extends 'layout/base.html' %}
{% block title %}Detalle de Ingreso{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>üè• Detalle de Ingreso #{{ ingreso.pk }}</h2>
        <a href="{% url 'ingreso_edit' ingreso.pk %}" class="btn btn-primary">
            Editar Datos de Ingreso
        </a>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">
            Informaci√≥n del Ingreso
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">Paciente</dt>
                <dd class="col-sm-9">
                    <a href="{% url 'paciente_detail' ingreso.paciente.pk %}">
                        {{ ingreso.paciente.nombres }} {{ ingreso.paciente.apellidos }} ({{ ingreso.paciente.rut }})
                    </a>
                </dd>
                
                <dt class="col-sm-3">Fecha de Ingreso</dt>
                <dd class="col-sm-9">{{ ingreso.fecha_ingreso|date:"d M Y H:i" }}</dd>

                <dt class="col-sm-3">Centro Asignado</dt>
                <dd class="col-sm-9">{{ ingreso.centro.nombre }}</dd>
                
                <dt class="col-sm-3">√Årea Asignada</dt>
                <dd class="col-sm-9">{{ ingreso.area.nombre }}</dd>
                
                <dt class="col-sm-3">Estado Actual</dt>
                <dd class="col-sm-9">
                    <span class="badge 
                        {% if ingreso.activo %}bg-danger{% else %}bg-success{% endif %}">
                        {{ ingreso.get_estado_display }}
                    </span>
                    ({% if ingreso.activo %}Activo{% else %}Cerrado{% endif %})
                </dd>
                
                {% if not ingreso.activo %}
                    <dt class="col-sm-3">Detalles de Alta</dt>
                    <dd class="col-sm-9 text-success">{{ ingreso.detalles_alta|default:"No especificado." }}</dd>
                {% endif %}
            </dl>
        </div>
    </div>
    
    <h3 class="mt-4">Ficha Cl√≠nica y Notas</h3>
    {% if ingreso.fichas.exists %}
        {% with ficha=ingreso.fichas.first %}
            <div class="alert alert-info d-flex justify-content-between align-items-center">
                <span>Esta ligado a la Ficha Cl√≠nica #{{ ficha.pk }}. Estado: **{{ ficha.get_estado_actual_display }}**</span>
                <a href="{% url 'ficha_detail' ficha.pk %}" class="btn btn-sm btn-info">
                    Ver Detalle de Ficha
                </a>
            </div>
        {% endwith %}
    {% else %}
        <p class="alert alert-warning">A√∫n no existe una Ficha Cl√≠nica creada para este ingreso.</p>
    {% endif %}

{% endblock %}